// src/components/Header.js
import React from 'react';
import { Link, NavLink, useNavigate } from 'react-router-dom';
import { FiSearch } from 'react-icons/fi';
import './Header.css';
import companyLogo from '../assets/bomare_logo.png';
import { supabase } from '../supabaseClient';

const Header = React.forwardRef(({
  onToggleSidebar,
  isSidebarOpen,
  navLinks = [],
  buttonRef
}, ref) => {

  const navigate = useNavigate();

  const handleLogout = async () => {
    const { error } = await supabase.auth.signOut();
    if (error) {
      console.error("Logout error:", error);
    } else {
      navigate('/login', { replace: true });
    }
  };

  const logoRootLink = navLinks.find(link => link.rootLink)?.rootLink ||
    (navLinks.length > 0 ? navLinks[0].to : "/");

  return (
    <header 
      ref={ref} 
      className={`app-header ${isSidebarOpen ? 'sidebar-effectively-open' : ''}`}
    >
      <div className="header-left"> {/* This part remains visible due to higher z-index */}
        <button 
          ref={buttonRef} 
          onClick={onToggleSidebar} 
          className={`menu-toggle-btn animated-icon ${isSidebarOpen ? 'open' : ''}`} 
          aria-label={isSidebarOpen ? "Fermer le menu" : "Ouvrir le menu"} 
          aria-expanded={isSidebarOpen}
        >
          <span></span><span></span><span></span>
        </button>
        <Link to={logoRootLink} className="logo-link">
          <img src={companyLogo} alt="BOMARE COMPANY Logo" className="company-logo-image" />
        </Link>
      </div>

      {/* These child elements will be hidden by CSS via parent .sidebar-effectively-open */}
      {navLinks && navLinks.length > 0 && (
        <nav className="header-nav">
          {navLinks.map((link) => (
            link.to && link.label && (
              link.isNavLink ? (
                <NavLink key={link.to} to={link.to} end={link.end || false}>
                  {link.label}
                </NavLink>
              ) : (
                <Link key={link.to} to={link.to}>
                  {link.label}
                </Link>
              )
            )
          ))}
        </nav>
      )}

      <div className="header-right">
        <button onClick={handleLogout} className="disconnect-btn">
          DÃ©connexion
        </button>
        <div className="search-bar-header">
          <input type="text" placeholder="Search text" />
          <FiSearch className="search-icon" />
        </div>
      </div>
    </header>
  );
});

export default Header;